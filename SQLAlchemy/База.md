# –†—É—á–∫–∞–º–∏ –≤ –ø–∏—Ç–æ–Ω–µ 

## –£–ø—Ä–æ—â–∞–µ–º —Å–µ–±–µ –∂–∏–∑–Ω—å

–ü–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å –ø–∏—Å–∞—Ç—å –Ω–∞ –≥–æ–ª–æ–º SQL? –ú–Ω–µ –Ω–µ—Ç, –∞ —ç—Ç–æ –º—ã –µ—â–µ –Ω–µ –ø—ã—Ç–∞–ª–∏—Å—å –∑–∞–ø—É—Å–∫–∞—Ç—å —ç—Ç–æ –±–µ–∑–æ–±—Ä–∞–∑–∏–µ –≤ python.

–ê –∫–∞–∫ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ë–î –∏–∑ python? 

1. –ó–∞–ø—É—Å–∫–∞—Ç—å SQL-—Å–∫–∏–ø—Ç—ã –∏–∑ python, –Ω–æ—É –Ω–æ—É –Ω–æ—É

2. –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏ (–∫–æ—Ç–æ—Ä—ã–µ –ª—é–±—è—Ç –≤—Ç—é—Ö–∏–≤–∞—Ç—å –≤—Å–µ —á—Ç–æ –Ω–µ –ø–æ–ø–∞–¥—è –ø–æ –ø–æ–¥–ø–∏—Å–∫–µ) –ø–∏—à—É—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ api, –Ω–æ —ç—Ç–æ –Ω–µ –Ω–∞—à —Å–ª—É—á–∞–π -
–º—ã –Ω–µ –±—É–¥–µ–º –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å —Å–µ–±—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –°–£–ë–î.

3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫, —É–º–µ—é—â–∏–π —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ø–æ—á—Ç–∏ –ª—é–±–æ–π –°–£–ë–î, –Ω–µ —Ç—Ä–µ–±—É—é—â–∏–π –∑–Ω–∞–Ω–∏—è SQL, c –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–π
–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π –∏ –æ–≥—Ä–æ–º–Ω—ã–π –∫–æ–º—å—é–Ω–∏—Ç–∏ - üëçüëçüëçüëçüëç

## SQlAlchemy

SQLAlchemy - –Ω–∞—à–µ —Ä–µ—à–µ–Ω–∏–µ, –æ–Ω –±—É–¥–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å SQL-–∑–∞–ø—Ä–æ—Å—ã –∏ –æ–±—â–∞—Ç—å—Å—è —Å –±–¥ –∑–≤ –Ω–∞—Å. 

–°–∞–º–∞—è –≤–∞–∂–Ω–∞—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å SQLAlchemy ‚Äî —ç—Ç–æ –µ–µ ORM. ORM –∏–ª–∏ Object Relational Mapper (–æ–±—ä–µ–∫—Ç–Ω–æ-—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ)
–ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é –æ–±—ä–µ–∫—Ç–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–¥–∞, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—è SQL-–∑–∞–ø—Ä–æ—Å—ã. 
–ï—â–µ –æ–¥–Ω–∞ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å SQLAlchemy ‚Äî –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –±—É–¥–µ—Ç –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è —Ç–µ–º –∂–µ –≤–Ω–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.
–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å –ª–µ–≥–∫–æ—Å—Ç—å—é –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å –æ–¥–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –¥—Ä—É–≥—É—é, –Ω–µ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞—è –∫–æ–¥.



## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

–í—Å–µ –µ—Å—Ç—å [—Ç—É—Ç](https://docs.sqlalchemy.org/en/20/intro.html#installation)

```bash
pip install SQLAlchemy
```

SQLAlchemy —É–º–µ–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ª—é–±–æ–π SQLdb, –Ω–æ –∫–∞–∫?
–í—Å–µ –ø—Ä–æ—Å—Ç–æ, –Ω–∞–¥–æ –ª–∏—à—å –∫–∞–∫ –≤ –∂–∏–∑–Ω–∏, –æ–±—É—á–∏—Ç—å SQLAlchemy –æ—Å–æ–±–æ–º—É –¥–∏–∞–ª–µ–∫—Ç—É SQL –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –°–£–ë–î

>–ù–µ—Å–º–æ—Ç—Ä—è
–Ω–∞ –Ω–∞–ª–∏—á–∏–µ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–≥–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞ ANSI SQL,
–º–Ω–æ–≥–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏, –∑–∞–Ω–∏–º–∞—é—â–∏–µ—Å—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–æ–π
–°–£–ë–î, –≤–Ω–æ—Å—è—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —è–∑—ã–∫ SQL,
–ø—Ä–∏–º–µ–Ω—è–µ–º—ã–π –≤
—Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º–æ–π –°–£–ë–î, —Ç–µ–º —Å–∞–º—ã–º –æ—Ç—Å—Ç—É–ø–∞—è –æ—Ç
—Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞. –ö–∞–∂–¥–∞—è
–∏–∑ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π —è–∑—ã–∫–∞ SQL –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –°–£–ë–î –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è **–¥–∏–∞–ª–µ–∫—Ç–æ–º**.


–í–æ—Ç –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –¥–∏–∞–ª–µ–∫—Ç—ã –∏ –¥—Ä–∞–π–≤–µ—Ä–∞:

- MySQL - PyMySQL, MySQL-Connector, CyMySQL, MySQL-Python (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- PostgreSQL - psycopg2 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é), pg8000,
- Microsoft SQL Server - PyODBC (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é), pymssql
- Oracle - cx-Oracle (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- Firebird - fdb (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é), kinterbasdb

–ù–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å PostgreSQL –Ω–∞–¥–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å:

```bash
pip install psycopg2
```

## –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ

![img.png](img.png)

–î–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏ —Å –ë–î –Ω–∞–º –ø–æ–Ω–∞–¥–æ–±–∏—Ç—å—Å—è –¥–≤–∏–∂–æ–∫ - engine.


```python
from sqlalchemy import create_engine

engine = create_engine(path)
```

```python
path = "dialect+driver://username:password@host:port/database"
```

–ü—Ä–∏–º–µ—Ä

```python
create_engine("postgresql+psycopg2://root:admin@localhost:5432/mydb")
```

```python
from sqlalchemy import text

engine = create_engine(path)

with engine.connect() as connection:
    result = connection.execute(text("select username from users")) 
    for row in result:
        print("username:", row.username)
```

**connection.execute** - –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å SQL-–∑–∞–ø—Ä–æ—Å—ã

–ù–æ —Å–æ–±—Ä–∞–ª–∏—Å—å –º—ã –∑–¥–µ—Å—å –Ω–µ –∑–∞ —ç—Ç–∏–º, –Ω–∞–ø–æ–º–∏–Ω–∞—é –ø—Ä–æ ORM.


## ORM

–ü—Ä–æ—Å—Ç–æ –æ–ø–∏—Å—ã–≤–∞–µ–º –Ω–∞—à–∏ —Ç–∞–±–ª–∏—Ü—ã –∫–∞–∫ –∫–ª–∞—Å—Å—ã

```python
from sqlalchemy import *
from sqlalchemy.orm import DeclarativeBase
import datetime

class Base(DeclarativeBase):
    pass


class User(Base):
    __tablename__ = "user_account"

    id = Column(Integer, primary_key=True)
    name = Column(String(30), nullable=False)
    fullname = Column(String)   
    created_date = Column(DateTime, default=datetime.datetime.utcnow)

```

–û–ø–∏—à–∏—Ç–µ —Å—É—â–Ω–æ—Å—Ç—å User


–ü—Ä–æ—Ä–∞—â–∏–≤–∞–Ω–∏–µ —Å–≤—è–∑–µ–π

```python
from sqlalchemy import *
from sqlalchemy.orm import relationship, DeclarativeBase

class Base(DeclarativeBase):
    pass

class Parent(Base):
    __tablename__ = 'parent'
    id = Column(Integer, primary_key=True)
    children = relationship("Child", backref="parent")

class Child(Base):
    __tablename__ = 'child'
    id = Column(Integer, primary_key=True)
    parent_id = Column(Integer, ForeignKey('parent.id'))
```

–û–ø–∏—à–∏—Ç–µ Parent –∏ Child

### –°–æ–∑–¥–∞–µ–º –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã

```python
Base.metadata.create_all(engine)
```

### –†–∞–±–æ—Ç–∞ —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏ 

–ö–ª–∞–¥–µ–º
```python
with Session(engine) as session:
    spongebob = User(
        name="–´asha",
        fullname="Sasha Kasha",
    )
    
    session.add(spongebob)
    session.commit()
```


–î–æ—Å—Ç–∞–µ–º
```python
with Session(engine) as session:
    print(session.execute(select(User)).first())
    print(session.execute(select(User.name)).first())
```

–ü—Ä–∏–º–µ—Ä—ã —Ä–∞–∑–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:

```python
select(User).where(User.name == "spongebob")
select(User).order_by(User.id)
select(User, Address).join(User.addresses)
```

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –¥–æ—Å—Ç–∞–µ–º –º—ã –æ–±—ä–µ–∫—Ç —Ç–∏–ø–∞ User, –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ select(User)

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤–º–µ—Å—Ç–µ —Å flask

[—Ç—É—Ç](https://flask-sqlalchemy.palletsprojects.com/en/3.1.x/quickstart/)


# –ó–∞–¥–∞–Ω–∏–µ
–°–æ–∑–¥–∞–π—Ç–µ –±–µ–∫–µ–Ω–¥ –¥–ª—è —Å–∞–π—Ç–∞ –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞–±–∏–Ω–µ—Ç–æ–≤. –ù—É–∂–Ω–æ —É–º–µ—Ç—å:
1) –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –∫–∞–±–∏–Ω–µ—Ç –Ω–∞ –∫–∞–∫–æ–π-—Ç–æ –ø—Ä–æ–º–µ–∂—É—Ç–æ–∫ –≤—Ä–µ–º–µ–Ω–∏
2) –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞–±–∏–Ω–µ—Ç–æ–≤
3) –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∫–∞–±–∏–Ω–µ—Ç (–∏–º–µ–µ—Ç –Ω–æ–º–µ—Ä, –≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å, —ç—Ç–∞–∂)

–ï—Å–ª–∏ —É—Å–ø–µ–≤–∞–µ—Ç–µ, –¥–æ–±–∞–≤—å—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
1) –ö–∞–∂–¥—ã–π –∏–º–µ–µ—Ç –ª–æ–≥–∏–Ω, –ø–∞—Ä–æ–ª—å, —Ñ–∏–æ
2) –ß—Ç–æ–±—ã –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –∫–∞–±–∏–Ω–µ—Ç, –Ω—É–∂–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è
3) –î–ª—è –∫–∞–∂–¥–æ–≥–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ö—Ä–∞–Ω–∏—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –∫–æ—Ç–æ—Ä—ã–π –µ–≥–æ —Å–æ–∑–¥–∞–ª